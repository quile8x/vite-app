import{const_web3DialogClosedByUser,useBlockNumberContext,useEthersContext}from"./chunk-SZO3HXET.js";import{asyncSome,parseProviderOrSigner}from"./chunk-ABR2QVOF.js";import{signerHasNetwork}from"./chunk-7TNBWNRY.js";import{__spreadValues}from"./chunk-EHDKCTCW.js";import{BigNumber}from"ethers";import{useState,useCallback,useEffect}from"react";import{useIsMounted}from"usehooks-ts";var zero=BigNumber.from(0),useBalance=address=>{let isMounted=useIsMounted(),{ethersProvider}=useEthersContext(),blockNumber=useBlockNumberContext(),[balance,setBalance]=useState(zero),callFunc=useCallback(async()=>{if(ethersProvider&&address){let newBalance=await ethersProvider.getBalance(address);isMounted()&&setBalance(value=>value.toHexString()!==(newBalance==null?void 0:newBalance.toHexString())?newBalance:value)}},[address,ethersProvider,isMounted]);return useEffect(()=>{callFunc()},[blockNumber,callFunc]),balance};import{useCallback as useCallback15,useState as useState13}from"react";import{useIsMounted as useIsMounted9}from"usehooks-ts";import{ethers,Wallet}from"ethers";import{useState as useState2,useEffect as useEffect2,useCallback as useCallback2,useRef}from"react";import{useDebounce}from"use-debounce";var isValidPk=pk=>(pk==null?void 0:pk.length)===64||(pk==null?void 0:pk.length)===66,saveBurnerKeyToStorage=incomingPK=>{if(isValidPk(incomingPK)){let rawPK=incomingPK;window.history.pushState({},"","/");let currentPrivateKey=window.localStorage.getItem("metaPrivateKey");currentPrivateKey&&currentPrivateKey!==rawPK&&(window.localStorage.setItem(`metaPrivateKey_backup${Date.now()}`,currentPrivateKey),console.log("\u{1F511} ...Saved Private Key")),window.localStorage.setItem("metaPrivateKey",rawPK.toString())}},loadBurnerKeyFromStorage=()=>window.localStorage.getItem("metaPrivateKey"),useBurnerSigner=localProvider=>{var _a;let key="scaffold-eth-burner-privateKey",[privateKeyValue,setPrivateKey]=useState2(),walletRef=useRef(),creatingBurnerRef=useRef(!1),[signer]=useDebounce(walletRef.current,200,{trailing:!0}),[account]=useDebounce((_a=walletRef.current)==null?void 0:_a.address,200,{trailing:!0}),setValue=value=>{try{setPrivateKey(value),window.localStorage.setItem(key,value)}catch(error){console.log(error)}};useEffect2(()=>{let storedKey=window.localStorage.getItem(key);if(storedKey)setValue(storedKey);else{console.log("generating a new key");let newKey=ethers.Wallet.createRandom().privateKey;setValue(newKey)}},[]),useEffect2(()=>{if(privateKeyValue&&localProvider){let newSigner=new ethers.Wallet(privateKeyValue).connect(localProvider);walletRef.current=newSigner}},[privateKeyValue,localProvider]);let saveToStorage=useCallback2(()=>{console.log("\u{1F511} Incoming Private Key..."),privateKeyValue!=null&&saveBurnerKeyToStorage(privateKeyValue)},[privateKeyValue]),generateBurnerSigner=useCallback2(()=>{if(localProvider&&!creatingBurnerRef.current){creatingBurnerRef.current=!0,console.log("\u{1F511} Create new burner wallet...");let wallet=Wallet.createRandom();setPrivateKey(_v=>(console.log("\u{1F4DD} ...Set key"),creatingBurnerRef.current=!1,wallet.privateKey))}else console.log("\u26A0 Could not create burner wallet")},[localProvider]),loadOrGenerateBurner=useCallback2(()=>{if(setPrivateKey!=null){let pk=loadBurnerKeyFromStorage();pk&&isValidPk(pk)?(console.log("\u{1F511} ...Loaded Private Key"),setPrivateKey(pk)):generateBurnerSigner()}},[generateBurnerSigner]);return{signer,account,saveBurner:saveToStorage,loadOrGenerateBurner,generateBurnerSigner,getBurnerPrivateKey:()=>privateKeyValue}};import{utils}from"ethers";import{useCallback as useCallback3,useEffect as useEffect3,useState as useState3}from"react";import{useIsMounted as useIsMounted2}from"usehooks-ts";var useContractExistsAtAddress=contract=>{let isMounted=useIsMounted2(),[contractIsDeployed,setContractIsDeployed]=useState3(!1),blockNumber=useBlockNumberContext(),callFunc=useCallback3(async()=>{if(!(contract==null?void 0:contract.provider)||!utils.isAddress(contract.address)){isMounted()&&setContractIsDeployed(!1);return}let bytecode=await contract.provider.getCode(contract.address);isMounted()&&setContractIsDeployed(bytecode!=="0x")},[contract,isMounted]);return useEffect3(()=>{callFunc()},[blockNumber,callFunc]),contractIsDeployed};import{BaseContract}from"ethers";import{useCallback as useCallback4,useEffect as useEffect4,useMemo,useState as useState4}from"react";import{useIsMounted as useIsMounted3}from"usehooks-ts";var parseContractsInJson=(contractList,chainId)=>{var _a,_b;let combinedContracts={};if((contractList==null?void 0:contractList[chainId])!=null){for(let network in contractList[chainId])if(Object.prototype.hasOwnProperty.call(contractList[chainId],network)){let chainContracts=(_b=(_a=contractList==null?void 0:contractList[chainId])==null?void 0:_a[network])==null?void 0:_b.contracts;chainContracts!=null&&(combinedContracts=__spreadValues(__spreadValues({},combinedContracts),chainContracts))}}return combinedContracts},useContractLoader=(config={},providerOrSigner,configChainId)=>{let isMounted=useIsMounted3(),{ethersProvider,chainId:contextChainId}=useEthersContext(),chainId=configChainId!=null?configChainId:contextChainId,[contracts,setContracts]=useState4({}),configDep=useMemo(()=>`${JSON.stringify(config!=null?config:{})}, ${JSON.stringify({chainId})}`,[chainId,config]),callFunc=useCallback4(()=>{var _a,_b;if(ethersProvider&&chainId&&chainId>0)try{let contractList=__spreadValues({},(_a=config.deployedContractsJson)!=null?_a:{}),externalContractList=__spreadValues({},(_b=config.externalContracts)!=null?_b:{}),combinedContracts=parseContractsInJson(contractList,chainId);(externalContractList==null?void 0:externalContractList[chainId])!=null&&(combinedContracts=__spreadValues(__spreadValues({},combinedContracts),externalContractList[chainId].contracts));let newContracts=Object.keys(combinedContracts).reduce((accumulator,contractName)=>{let address=config.customAddresses&&Object.keys(config.customAddresses).includes(contractName)?config.customAddresses[contractName]:combinedContracts[contractName].address,provider=providerOrSigner!=null?providerOrSigner:chainId===contextChainId?ethersProvider:void 0;return accumulator[contractName]=new BaseContract(address,combinedContracts[contractName].abi,provider),accumulator},{});isMounted()&&setContracts(currValue=>currValue!==newContracts&&(Object.keys(currValue).length>0||Object.keys(newContracts).length>0)?(console.log("\u{1F300} loading contracts.."),newContracts):currValue)}catch(e){console.log("\u26A0 useContractLoader, ERROR LOADING CONTRACTS!!",e,config)}},[ethersProvider,configDep,providerOrSigner]);return useEffect4(()=>{callFunc()},[callFunc,chainId]),contracts};import{useCallback as useCallback5,useEffect as useEffect5,useState as useState5}from"react";import{useIsMounted as useIsMounted4}from"usehooks-ts";var useContractReader=(contract,contractFunctionInfo,formatter,onChange)=>{let isMounted=useIsMounted4(),[value,setValue]=useState5(),blockNumber=useBlockNumberContext(),ethersContext=useEthersContext(),callContractFunction=useCallback5(async()=>{var _a;let contractFunction=(_a=contract.functions)==null?void 0:_a[contractFunctionInfo.functionName],result;try{contractFunctionInfo.functionArgs&&contractFunctionInfo.functionArgs.length>0?result=await(contractFunction==null?void 0:contractFunction(...contractFunctionInfo.functionArgs)):result=await(contractFunction==null?void 0:contractFunction())}catch{console.warn("Could not read from contract function",contractFunctionInfo)}return result},[contract,contractFunctionInfo.functionArgs,contractFunctionInfo.functionName]),contractProvider=contract==null?void 0:contract.provider,callFunc=useCallback5(async()=>{var _a;let contractChainId=(_a=await(contractProvider==null?void 0:contractProvider.getNetwork()))==null?void 0:_a.chainId;if(callContractFunction!=null&&contractChainId===ethersContext.chainId&&contractProvider!=null&&(ethersContext==null?void 0:ethersContext.chainId))try{let newResult=await callContractFunction();formatter!=null&&(newResult=formatter(newResult)),isMounted()&&(setValue(value2=>!Object.is(value2,newResult)&&JSON.stringify(value2)!==JSON.stringify(newResult)?newResult:value2),onChange==null||onChange(newResult))}catch(error){console.warn(error)}},[contractProvider,callContractFunction,ethersContext==null?void 0:ethersContext.chainId,formatter,isMounted,onChange]);return useEffect5(()=>{callFunc()},[blockNumber,callFunc]),value};import{useState as useState6,useEffect as useEffect6,useCallback as useCallback6}from"react";import{useIsMounted as useIsMounted5}from"usehooks-ts";var getEventKey=m=>`${m.transactionHash}_${m.logIndex}`,useEventListener=(contract,eventName,startBlock)=>{let isMounted=useIsMounted5(),[eventMap,setEventMap]=useState6([]),queryEvents=useCallback6(_listenerArgs=>{(async()=>{let result=await(contract==null?void 0:contract.queryFilter(eventName,startBlock));isMounted()&&result&&setEventMap(value=>JSON.stringify(value.map(getEventKey))!==JSON.stringify(result.map(getEventKey))?result:value)})()},[contract,eventName,isMounted,startBlock]);return useEffect6(()=>{(contract==null?void 0:contract.queryFilter)!=null&&setEventMap&&(eventMap==null||(eventMap==null?void 0:eventMap.length)===0)&&queryEvents&&queryEvents([])},[contract==null?void 0:contract.queryFilter]),useEffect6(()=>{try{return contract==null||contract.on(eventName,queryEvents),()=>{contract==null||contract.off(eventName,queryEvents)}}catch(e){console.log(e)}},[queryEvents,contract,eventName]),eventMap};import axios from"axios";import{utils as utils2}from"ethers";import{useCallback as useCallback7,useEffect as useEffect7,useState as useState7}from"react";import{useDebounce as useDebounce2}from"use-debounce";var useGasPrice=(chainId,speed,currentNetworkInfo)=>{let{ethersProvider}=useEthersContext(),blockNumber=useBlockNumberContext(),[currentChainId,setCurrentChainId]=useState7(),[gasPrice,setGasPrice]=useState7(),[gasPriceDebounced]=useDebounce2(gasPrice,250,{trailing:!0}),callFunc=useCallback7(()=>{if(currentChainId!==chainId&&(setCurrentChainId(chainId),setGasPrice(void 0)),!chainId)setGasPrice(void 0);else if(chainId===1){if(navigator.onLine){let gweiFactor=10;axios.get("https://ethgasstation.info/json/ethgasAPI.json").then(response=>{var _a;let result=(_a=response.data)!=null?_a:{},newGasPrice=result[speed]/gweiFactor;newGasPrice||(newGasPrice=result.fast/gweiFactor),setGasPrice(newGasPrice)}).catch(error=>{console.log("\u26A0 Could not get gas Price!",error),setGasPrice(void 0)})}}else ethersProvider?ethersProvider.getFeeData().then(fee=>{var _a,_b;let price=(_a=fee.gasPrice)!=null?_a:fee.maxFeePerGas;if(price&&(price==null?void 0:price.toBigInt())>0){let result=(_b=parseInt(utils2.formatUnits(price,"gwei")))!=null?_b:0;setGasPrice(result)}else(currentNetworkInfo==null?void 0:currentNetworkInfo.gasPrice)?setGasPrice(currentNetworkInfo.gasPrice):setGasPrice(void 0)}).catch(_error=>{console.log("\u26A0 Could not estimate gas!"),(currentNetworkInfo==null?void 0:currentNetworkInfo.gasPrice)?setGasPrice(currentNetworkInfo.gasPrice):setGasPrice(void 0)}):(currentNetworkInfo==null?void 0:currentNetworkInfo.gasPrice)?setGasPrice(currentNetworkInfo.gasPrice):setGasPrice(void 0)},[currentChainId,chainId,ethersProvider,currentNetworkInfo==null?void 0:currentNetworkInfo.gasPrice,speed]);return useEffect7(()=>{callFunc()},[blockNumber,callFunc]),gasPriceDebounced};import{useCallback as useCallback8,useEffect as useEffect8,useState as useState8}from"react";var useGetUserFromProviders=(currentProvider,...moreProviders)=>{let[signer,setSigner]=useState8(),[provider,setProvider]=useState8(),[providerNetwork,setProviderNetwork]=useState8(),[address,setAddress]=useState8(),allProviders=[currentProvider,...moreProviders].filter(f=>f!=null),providerDeps=allProviders.map(m=>{var _a,_b;return`${(_a=m==null?void 0:m.network)==null?void 0:_a.name}_${(_b=m==null?void 0:m.network)==null?void 0:_b.chainId}_${m==null?void 0:m.connection.url}`}).reduce((acc,value)=>acc?acc+value:value!=null?value:"",""),callFunc=useCallback8(async()=>{!await asyncSome(allProviders,async provider2=>{let result=await parseProviderOrSigner(provider2);if(result.provider&&result.providerNetwork&&result.signer){setSigner(result.signer),setProvider(result.provider),setProviderNetwork(result.providerNetwork);let address2=await result.signer.getAddress();return setAddress(address2),!0}return!1})&&currentProvider!=null&&(setProvider(currentProvider),setSigner(void 0),setProviderNetwork(void 0),setAddress(void 0))},[providerDeps]);return useEffect8(()=>{callFunc()},[callFunc]),{signer,provider,providerNetwork,address}};import{useCallback as useCallback9,useEffect as useEffect9,useState as useState9}from"react";var useGetUserFromSigners=signer=>{let[resolvedSigner,setResolvedSigner]=useState9(),[provider,setProvider]=useState9(),[providerNetwork,setProviderNetwork]=useState9(),[address,setAddress]=useState9(),callFunc=useCallback9(async()=>{let result=await parseProviderOrSigner(signer);if(result.provider&&result.providerNetwork&&result.signer){setResolvedSigner(result.signer),setProvider(result.provider),setProviderNetwork(result.providerNetwork);let address2=await result.signer.getAddress();setAddress(address2)}else setProvider(void 0),setResolvedSigner(signer),setProviderNetwork(void 0),setAddress(void 0)},[signer]);return useEffect9(()=>{callFunc()},[callFunc]),{signer:resolvedSigner,provider,providerNetwork,address}};import{useCallback as useCallback10,useEffect as useEffect10,useState as useState10}from"react";import{useIsMounted as useIsMounted6}from"usehooks-ts";var useNonce=address=>{let isMounted=useIsMounted6(),{ethersProvider}=useEthersContext(),blockNumber=useBlockNumberContext(),[nonce,setNonce]=useState10(0),callFunc=useCallback10(async()=>{var _a;let nextNonce=0;try{nextNonce=(_a=await(ethersProvider==null?void 0:ethersProvider.getTransactionCount(address)))!=null?_a:0}catch{}isMounted()&&setNonce(value=>nextNonce&&value!==nextNonce&&value<nextNonce?nextNonce:value)},[address,ethersProvider,isMounted]);return useEffect10(()=>{callFunc()},[blockNumber,callFunc]),nonce};import{useCallback as useCallback11,useEffect as useEffect11,useRef as useRef2}from"react";var DEBUG=!1,useOnRepetition=(callback,options,...args)=>{var _a,_b;let isPolling=(options==null?void 0:options.pollTime)!=null&&options.pollTime>0,readyForEvents=(options==null?void 0:options.provider)&&!isPolling&&((_b=(_a=options==null?void 0:options.provider)==null?void 0:_a.network)==null?void 0:_b.chainId)>0,readyForLeadTrigger=(readyForEvents||isPolling)&&(options==null?void 0:options.leadingTrigger),isFirstCall=useRef2(!0),argDeps=JSON.stringify(args!=null?args:[]),callFunctionWithArgs=useCallback11(()=>{DEBUG&&console.log("create callback"),callback&&(args&&args.length>0?callback(...args):callback())},[callback,argDeps]),listener=useCallback11(_blockNumber=>{readyForEvents&&callFunctionWithArgs()},[callFunctionWithArgs,readyForEvents]);useEffect11(()=>{var _a2,_b2;return readyForEvents&&((_b2=(_a2=options==null?void 0:options.provider)==null?void 0:_a2.addListener)==null||_b2.call(_a2,"block",listener)),()=>{var _a3,_b3;(_b3=(_a3=options==null?void 0:options.provider)==null?void 0:_a3.removeListener)==null||_b3.call(_a3,"block",listener)}},[options.provider,readyForEvents,listener]),useEffect11(()=>{var _a2;let tick=()=>{DEBUG&&console.log("polling: call function"),callFunctionWithArgs()};if(isPolling){let safePollTime=((_a2=options==null?void 0:options.pollTime)!=null?_a2:0)>1e4?options.pollTime:1e4,id=setInterval(tick,safePollTime);return()=>{clearInterval(id)}}},[options.pollTime,isPolling,callFunctionWithArgs]),useEffect11(()=>{isFirstCall.current||(isFirstCall.current=!0)},[argDeps]),useEffect11(()=>{readyForLeadTrigger&&callFunctionWithArgs!=null&&(isFirstCall==null?void 0:isFirstCall.current)===!0&&(isFirstCall.current=!1,callFunctionWithArgs())},[callFunctionWithArgs,readyForLeadTrigger])};import{useState as useState11,useEffect as useEffect12,useCallback as useCallback12}from"react";import{useIsMounted as useIsMounted7}from"usehooks-ts";var useTimestamp=()=>{let isMounted=useIsMounted7(),{ethersProvider}=useEthersContext(),blockNumber=useBlockNumberContext(),[timestamp,setTimestamp]=useState11(0),callFunc=useCallback12(async()=>{if(blockNumber!=null){let block=await(ethersProvider==null?void 0:ethersProvider.getBlock(blockNumber));if((block==null?void 0:block.timestamp)!=null){let nextTimestamp=block.timestamp;isMounted()&&setTimestamp(nextTimestamp)}}},[blockNumber,ethersProvider,isMounted]);return useEffect12(()=>{callFunc()},[blockNumber,callFunc]),timestamp};import{useState as useState12,useEffect as useEffect13,useCallback as useCallback13}from"react";import{useIsMounted as useIsMounted8}from"usehooks-ts";var useUserAddress=signer=>{let isMounted=useIsMounted8(),[userAddress,setUserAddress]=useState12(),blockNumber=useBlockNumberContext(),callFunc=useCallback13(async()=>{if(signerHasNetwork(signer)){let address=await(signer==null?void 0:signer.getAddress());isMounted()&&setUserAddress(address)}},[isMounted,signer]);return useEffect13(()=>{callFunc()},[blockNumber,callFunc]),userAddress};import{Web3Provider}from"@ethersproject/providers";import{useCallback as useCallback14,useEffect as useEffect14,useRef as useRef3}from"react";import Web3Modal from"web3modal";var useWeb3Modal=(web3ModalConfig,setCurrentEthersProvider)=>{var _a;let web3ModalProviderRef=useRef3(),initalizingRef=useRef3();useEffect14(()=>{if(!Web3Modal)throw"Web3Modal is a peer dependancy to use this hook";web3ModalProviderRef.current=new Web3Modal(web3ModalConfig!=null?web3ModalConfig:{}),initalizingRef.current=!0,setCurrentEthersProvider(void 0)},[web3ModalConfig]);let reloadPage=useCallback14(()=>_param=>{var _a2;((_a2=web3ModalProviderRef.current)==null?void 0:_a2.cachedProvider)&&setTimeout(()=>{window.location.reload()},1)},[]),logoutOfWeb3ModalCallback=useCallback14((reload=!0)=>{initalizingRef.current=!1,setCurrentEthersProvider(void 0),reload&&reloadPage()},[setCurrentEthersProvider]),loadWeb3Modal=useCallback14(async()=>{var _a2;try{initalizingRef.current=!0;let provider=await((_a2=web3ModalProviderRef.current)==null?void 0:_a2.connect());setCurrentEthersProvider(new Web3Provider(provider,"any")),(provider==null?void 0:provider.on)&&(provider.on("chainChanged",chainId=>{console.log(`chain changed to ${chainId}! updating providers`),setCurrentEthersProvider(new Web3Provider(provider,"any"))}),provider.on("accountsChanged",()=>{console.log("account changed!"),setCurrentEthersProvider(new Web3Provider(provider,"any"))}),provider.on("disconnect",(code,reason)=>{console.log(code,reason),logoutOfWeb3ModalCallback(),setCurrentEthersProvider(void 0)}))}catch(e){if(e.includes(const_web3DialogClosedByUser))console.log(e);else throw e}finally{initalizingRef.current=!1}},[setCurrentEthersProvider]);useEffect14(()=>{var _a2;((_a2=web3ModalProviderRef.current)==null?void 0:_a2.cachedProvider)&&loadWeb3Modal()},[loadWeb3Modal]);let openWeb3ModalCallback=useCallback14(()=>{var _a2;setCurrentEthersProvider(void 0),(_a2=web3ModalProviderRef.current)==null||_a2.clearCachedProvider(),loadWeb3Modal()},[loadWeb3Modal]),updateWeb3ModalThemeCallback=useCallback14(theme=>{var _a2;(_a2=web3ModalProviderRef.current)==null||_a2.updateTheme(theme)},[]);return{initializing:(_a=initalizingRef.current)!=null?_a:!1,openWeb3ModalCallback,logoutOfWeb3ModalCallback,updateWeb3ModalThemeCallback}};var useBlockNumber=(provider,pollTime=0)=>{let[blockNumber,setBlockNumber]=useState13(0),isMounted=useIsMounted9(),getBlockNumber=useCallback15(async()=>{let nextBlockNumber=await(provider==null?void 0:provider.getBlockNumber());isMounted()&&provider!=null&&setBlockNumber(value=>value!==nextBlockNumber?nextBlockNumber!=null?nextBlockNumber:0:value)},[provider,isMounted]);return useOnRepetition(getBlockNumber,{provider,pollTime}),blockNumber};export{useBalance,useBlockNumber,useBurnerSigner,useContractExistsAtAddress,parseContractsInJson,useContractLoader,useContractReader,useEventListener,useGasPrice,useGetUserFromProviders,useGetUserFromSigners,useNonce,useOnRepetition,useTimestamp,useUserAddress,useWeb3Modal};
//# sourceMappingURL=chunk-PNTNPJDE.js.map
