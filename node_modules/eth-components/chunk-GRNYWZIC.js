import{checkBlocknativeAppId}from"./chunk-5EJARFTI.js";import{__spreadValues}from"./chunk-5WBKJH57.js";import{notification}from"antd";import Notify from"bnc-notify";import{parseProviderOrSigner}from"eth-hooks/functions";import{BigNumber,ethers}from"ethers";var callbacks={},DEBUG=!0,transactor=(settings,signer,gasPrice,etherscan,throwOnError=!1)=>{if(signer!=null)return async(tx,callback)=>{let{provider,providerNetwork}=await parseProviderOrSigner(signer);checkBlocknativeAppId(settings);let options,notify;navigator.onLine&&(options={dappId:settings.apiKeys.BlocknativeDappId,system:"ethereum",networkId:providerNetwork==null?void 0:providerNetwork.chainId,transactionHandler:txInformation=>{DEBUG&&console.log("HANDLE TX",txInformation);let possibleFunction=callbacks[txInformation.transaction.hash];typeof possibleFunction=="function"&&possibleFunction(txInformation.transaction)}},notify=Notify(options));let etherscanNetwork="";(providerNetwork==null?void 0:providerNetwork.name)&&(providerNetwork==null?void 0:providerNetwork.chainId)>1&&(etherscanNetwork=providerNetwork.name+".");let etherscanTxUrl="https://"+etherscanNetwork+"etherscan.io/tx/";(providerNetwork==null?void 0:providerNetwork.chainId)===100&&(etherscanTxUrl="https://blockscout.com/poa/xdai/tx/");try{let result;if(tx instanceof Promise?(DEBUG&&console.log("AWAITING TX",tx),result=await tx):(tx.gasPrice||(tx.gasPrice=gasPrice||ethers.utils.parseUnits("4.1","gwei")),tx.gasLimit||(tx.gasLimit=BigNumber.from(ethers.utils.hexlify(12e4))),DEBUG&&console.log("RUNNING TX",tx),result=await(signer==null?void 0:signer.sendTransaction(tx))),DEBUG&&console.log("RESULT:",result),callback&&result&&(callbacks[result.hash]=callback),result&&"wait"in result&&result.wait){if(providerNetwork!=null&&[1,3,4,5,42,100].indexOf(providerNetwork.chainId)>=0&&notify!=null){let{emitter}=notify.hash(result.hash);emitter.on("all",transaction=>({onclick:()=>{var _a,_b;window.open(`${(_a=etherscan!=null?etherscan:etherscanTxUrl)!=null?_a:""}${(_b=transaction.hash)!=null?_b:""}`)}}))}else if(notification.info({message:"Local Transaction Sent",description:result==null?void 0:result.hash,placement:"bottomRight"}),callback!=null&&(result==null?void 0:result.hash)!=null){let listeningInterval;listeningInterval=setInterval(async()=>{if((result==null?void 0:result.hash)!=null){console.log("CHECK IN ON THE TX",result,provider);let currentTransactionReceipt=await(provider==null?void 0:provider.getTransactionReceipt(result.hash));currentTransactionReceipt&&currentTransactionReceipt.confirmations&&(callback(__spreadValues(__spreadValues({},result),currentTransactionReceipt)),listeningInterval&&clearInterval(listeningInterval))}},500)}await result.wait()}return result}catch(e){if(DEBUG&&console.log(e),notification.error({message:"Transaction Error",description:e==null?void 0:e.message}),throwOnError)throw e}}};export{transactor};
//# sourceMappingURL=chunk-GRNYWZIC.js.map
